import{r as f,n as le,D as Q,y as U,o as Pe,p as R,R as ce,q as Re,s as xe,t as B,X as K,I as Y,v as ve,w as Se,x as je,z as G,A as Ee,T as Ne,B as b,F as Ce,G as J,H as ke,J as ue,K as ge,P as Ae,u as De,Q as F,a as S,U as Me,V as D,e as T,W as P,Y as z,Z as Fe,j as t,d as j,$ as X,a0 as W,c as M,S as ye,a1 as Te,a2 as be,a3 as de,a4 as H,a5 as $e}from"./index-cdd8dc4e.js";import{C as Le,I as me}from"./Input-b5a2f25d.js";import{E as A}from"./context-3f167892.js";import{F as Oe,P as fe}from"./PlanChangePreview-1c0cfb16.js";import{b as _e,u as ze,a as N,x as Be}from"./context-f02ccab3.js";import{s as Qe,k as pe}from"./popover-7912afb1.js";import"./ModelLineage-48374ad8.js";import"./PlusIcon-9c8d5f8d.js";import"./disclosure-51f7e0a0.js";import"./_commonjs-dynamic-modules-302442b1.js";function Ue({title:e,titleId:a,...i},n){return f.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true",ref:n,"aria-labelledby":a},i),e?f.createElement("title",{id:a},e):null,f.createElement("path",{fillRule:"evenodd",d:"M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12zm13.36-1.814a.75.75 0 10-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 00-1.06 1.06l2.25 2.25a.75.75 0 001.14-.094l3.75-5.25z",clipRule:"evenodd"}))}const Ke=f.forwardRef(Ue),Ve=Ke;var Ge=(e=>(e[e.Open=0]="Open",e[e.Closed=1]="Closed",e))(Ge||{}),He=(e=>(e[e.Pointer=0]="Pointer",e[e.Other=1]="Other",e))(He||{}),qe=(e=>(e[e.OpenMenu=0]="OpenMenu",e[e.CloseMenu=1]="CloseMenu",e[e.GoToItem=2]="GoToItem",e[e.Search=3]="Search",e[e.ClearSearch=4]="ClearSearch",e[e.RegisterItem=5]="RegisterItem",e[e.UnregisterItem=6]="UnregisterItem",e))(qe||{});function q(e,a=i=>i){let i=e.activeItemIndex!==null?e.items[e.activeItemIndex]:null,n=Ae(a(e.items.slice()),u=>u.dataRef.current.domRef.current),o=i?n.indexOf(i):null;return o===-1&&(o=null),{items:n,activeItemIndex:o}}let Je={1(e){return e.menuState===1?e:{...e,activeItemIndex:null,menuState:1}},0(e){return e.menuState===0?e:{...e,__demoMode:!1,menuState:0}},2:(e,a)=>{var i;let n=q(e),o=Be(a,{resolveItems:()=>n.items,resolveActiveIndex:()=>n.activeItemIndex,resolveId:u=>u.id,resolveDisabled:u=>u.dataRef.current.disabled});return{...e,...n,searchQuery:"",activeItemIndex:o,activationTrigger:(i=a.trigger)!=null?i:1}},3:(e,a)=>{let i=e.searchQuery!==""?0:1,n=e.searchQuery+a.value.toLowerCase(),o=(e.activeItemIndex!==null?e.items.slice(e.activeItemIndex+i).concat(e.items.slice(0,e.activeItemIndex+i)):e.items).find(c=>{var s;return((s=c.dataRef.current.textValue)==null?void 0:s.startsWith(n))&&!c.dataRef.current.disabled}),u=o?e.items.indexOf(o):-1;return u===-1||u===e.activeItemIndex?{...e,searchQuery:n}:{...e,searchQuery:n,activeItemIndex:u,activationTrigger:1}},4(e){return e.searchQuery===""?e:{...e,searchQuery:"",searchActiveItemIndex:null}},5:(e,a)=>{let i=q(e,n=>[...n,{id:a.id,dataRef:a.dataRef}]);return{...e,...i}},6:(e,a)=>{let i=q(e,n=>{let o=n.findIndex(u=>u.id===a.id);return o!==-1&&n.splice(o,1),n});return{...e,...i,activationTrigger:1}}},Z=f.createContext(null);Z.displayName="MenuContext";function V(e){let a=f.useContext(Z);if(a===null){let i=new Error(`<${e} /> is missing a parent <Menu /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(i,V),i}return a}function We(e,a){return xe(a.type,Je,e,a)}let Ye=f.Fragment;function Xe(e,a){let{__demoMode:i=!1,...n}=e,o=f.useReducer(We,{__demoMode:i,menuState:i?0:1,buttonRef:f.createRef(),itemsRef:f.createRef(),items:[],searchQuery:"",activeItemIndex:null,activationTrigger:1}),[{menuState:u,itemsRef:c,buttonRef:s},r]=o,x=U(a);Pe([s,c],(I,w)=>{var h;r({type:1}),Ee(w,Ne.Loose)||(I.preventDefault(),(h=s.current)==null||h.focus())},u===0);let g=R(()=>{r({type:1})}),d=f.useMemo(()=>({open:u===0,close:g}),[u,g]),m={ref:x};return ce.createElement(Z.Provider,{value:o},ce.createElement(Re,{value:xe(u,{0:B.Open,1:B.Closed})},K({ourProps:m,theirProps:n,slot:d,defaultTag:Ye,name:"Menu"})))}let Ze="button";function et(e,a){var i;let n=Y(),{id:o=`headlessui-menu-button-${n}`,...u}=e,[c,s]=V("Menu.Button"),r=U(c.buttonRef,a),x=ve(),g=R(h=>{switch(h.key){case b.Space:case b.Enter:case b.ArrowDown:h.preventDefault(),h.stopPropagation(),s({type:0}),x.nextFrame(()=>s({type:2,focus:N.First}));break;case b.ArrowUp:h.preventDefault(),h.stopPropagation(),s({type:0}),x.nextFrame(()=>s({type:2,focus:N.Last}));break}}),d=R(h=>{switch(h.key){case b.Space:h.preventDefault();break}}),m=R(h=>{if(Ce(h.currentTarget))return h.preventDefault();e.disabled||(c.menuState===0?(s({type:1}),x.nextFrame(()=>{var E;return(E=c.buttonRef.current)==null?void 0:E.focus({preventScroll:!0})})):(h.preventDefault(),s({type:0})))}),I=f.useMemo(()=>({open:c.menuState===0}),[c]),w={ref:r,id:o,type:Qe(e,c.buttonRef),"aria-haspopup":"menu","aria-controls":(i=c.itemsRef.current)==null?void 0:i.id,"aria-expanded":c.menuState===0,onKeyDown:g,onKeyUp:d,onClick:m};return K({ourProps:w,theirProps:u,slot:I,defaultTag:Ze,name:"Menu.Button"})}let tt="div",nt=le.RenderStrategy|le.Static;function at(e,a){var i,n;let o=Y(),{id:u=`headlessui-menu-items-${o}`,...c}=e,[s,r]=V("Menu.Items"),x=U(s.itemsRef,a),g=Se(s.itemsRef),d=ve(),m=je(),I=(()=>m!==null?(m&B.Open)===B.Open:s.menuState===0)();f.useEffect(()=>{let l=s.itemsRef.current;l&&s.menuState===0&&l!==(g==null?void 0:g.activeElement)&&l.focus({preventScroll:!0})},[s.menuState,s.itemsRef,g]),Oe({container:s.itemsRef.current,enabled:s.menuState===0,accept(l){return l.getAttribute("role")==="menuitem"?NodeFilter.FILTER_REJECT:l.hasAttribute("role")?NodeFilter.FILTER_SKIP:NodeFilter.FILTER_ACCEPT},walk(l){l.setAttribute("role","none")}});let w=R(l=>{var y,k;switch(d.dispose(),l.key){case b.Space:if(s.searchQuery!=="")return l.preventDefault(),l.stopPropagation(),r({type:3,value:l.key});case b.Enter:if(l.preventDefault(),l.stopPropagation(),r({type:1}),s.activeItemIndex!==null){let{dataRef:v}=s.items[s.activeItemIndex];(k=(y=v.current)==null?void 0:y.domRef.current)==null||k.click()}ge(s.buttonRef.current);break;case b.ArrowDown:return l.preventDefault(),l.stopPropagation(),r({type:2,focus:N.Next});case b.ArrowUp:return l.preventDefault(),l.stopPropagation(),r({type:2,focus:N.Previous});case b.Home:case b.PageUp:return l.preventDefault(),l.stopPropagation(),r({type:2,focus:N.First});case b.End:case b.PageDown:return l.preventDefault(),l.stopPropagation(),r({type:2,focus:N.Last});case b.Escape:l.preventDefault(),l.stopPropagation(),r({type:1}),J().nextFrame(()=>{var v;return(v=s.buttonRef.current)==null?void 0:v.focus({preventScroll:!0})});break;case b.Tab:l.preventDefault(),l.stopPropagation(),r({type:1}),J().nextFrame(()=>{ke(s.buttonRef.current,l.shiftKey?ue.Previous:ue.Next)});break;default:l.key.length===1&&(r({type:3,value:l.key}),d.setTimeout(()=>r({type:4}),350));break}}),h=R(l=>{switch(l.key){case b.Space:l.preventDefault();break}}),E=f.useMemo(()=>({open:s.menuState===0}),[s]),C={"aria-activedescendant":s.activeItemIndex===null||(i=s.items[s.activeItemIndex])==null?void 0:i.id,"aria-labelledby":(n=s.buttonRef.current)==null?void 0:n.id,id:u,onKeyDown:w,onKeyUp:h,role:"menu",tabIndex:0,ref:x};return K({ourProps:C,theirProps:c,slot:E,defaultTag:tt,features:nt,visible:I,name:"Menu.Items"})}let st=f.Fragment;function rt(e,a){let i=Y(),{id:n=`headlessui-menu-item-${i}`,disabled:o=!1,...u}=e,[c,s]=V("Menu.Item"),r=c.activeItemIndex!==null?c.items[c.activeItemIndex].id===n:!1,x=f.useRef(null),g=U(a,x);G(()=>{if(c.__demoMode||c.menuState!==0||!r||c.activationTrigger===0)return;let v=J();return v.requestAnimationFrame(()=>{var $,L;(L=($=x.current)==null?void 0:$.scrollIntoView)==null||L.call($,{block:"nearest"})}),v.dispose},[c.__demoMode,x,r,c.menuState,c.activationTrigger,c.activeItemIndex]);let d=_e(x),m=f.useRef({disabled:o,domRef:x,get textValue(){return d()}});G(()=>{m.current.disabled=o},[m,o]),G(()=>(s({type:5,id:n,dataRef:m}),()=>s({type:6,id:n})),[m,n]);let I=R(()=>{s({type:1})}),w=R(v=>{if(o)return v.preventDefault();s({type:1}),ge(c.buttonRef.current)}),h=R(()=>{if(o)return s({type:2,focus:N.Nothing});s({type:2,focus:N.Specific,id:n})}),E=ze(),C=R(v=>E.update(v)),l=R(v=>{E.wasMoved(v)&&(o||r||s({type:2,focus:N.Specific,id:n,trigger:0}))}),y=R(v=>{E.wasMoved(v)&&(o||r&&s({type:2,focus:N.Nothing}))}),k=f.useMemo(()=>({active:r,disabled:o,close:I}),[r,o,I]);return K({ourProps:{id:n,ref:g,role:"menuitem",tabIndex:o===!0?void 0:-1,"aria-disabled":o===!0?!0:void 0,disabled:void 0,onClick:w,onFocus:h,onPointerEnter:C,onMouseEnter:C,onPointerMove:l,onMouseMove:l,onPointerLeave:y,onMouseLeave:y},theirProps:u,slot:k,defaultTag:st,name:"Menu.Item"})}let it=Q(Xe),ot=Q(et),lt=Q(at),ct=Q(rt),O=Object.assign(it,{Button:ot,Items:lt,Item:ct});function wt(){const{setIsPlanOpen:e}=De(),a=F(p=>p.state),i=F(p=>p.action),n=F(p=>p.setState),o=F(p=>p.setAction),u=F(p=>p.setActivePlan),c=S(p=>p.addConfirmation),s=S(p=>p.setShowConfirmation),r=S(p=>p.environment),x=S(p=>p.environments),g=S(p=>p.setInitialDates),d=S(p=>p.hasSynchronizedEnvironments),[m,I]=f.useState(!1),[w,h]=f.useState(),[E,C]=f.useState(!1),{refetch:l,data:y,isFetching:k}=Me(r.name,{planOptions:{skip_tests:!0,include_unmodified:!0}});f.useEffect(()=>{E&&(v(),C(!1)),!D(r.isSynchronized)&&l()},[r]),f.useEffect(()=>{var p,te,ne,ae,se,re,ie,oe;y!=null&&(h(y),g(y.start,y.end),I([(p=y.changes)==null?void 0:p.added,(te=y.changes)==null?void 0:te.removed,(ae=(ne=y.changes)==null?void 0:ne.modified)==null?void 0:ae.direct,(re=(se=y.changes)==null?void 0:se.modified)==null?void 0:re.indirect,(oe=(ie=y.changes)==null?void 0:ie.modified)==null?void 0:oe.metadata].some(T)))},[y]);function v(){u(void 0),n(P.Init),o(z.Run),e(!0)}const L=(D(r.isDefault)||d())&&(D(r.isDefault)||D(r.isInitial)),we=Fe([P.Applying,P.Running,P.Cancelling],a),ee=k||i!==z.None||a===P.Applying||a===P.Running||a===P.Cancelling;return t.jsxs("div",{className:j("flex items-center",r==null&&"opacity-50 pointer-events-none cursor-not-allowed"),children:[t.jsxs("div",{className:"flex items-center relative",children:[t.jsxs(X,{className:j("mx-0",D(r.isInitial&&r.isDefault)&&"rounded-none rounded-l-lg border-r"),disabled:ee,variant:W.Alternative,size:M.sm,onClick:p=>{p.stopPropagation(),r.isDefault&&D(r.isInitial)?c({headline:"Running Plan Directly On Prod Environment!",description:"Are you sure you want to run your changes directly on prod? Safer choice will be to select or add new environment first.",yesText:`Yes, Run ${r.name}`,noText:"No, Cancel",action(){v()},children:t.jsxs("div",{className:"mt-5 pt-4",children:[t.jsx("h4",{className:"mb-2",children:`${x.size>1?"Select or ":""}Add Environment`}),t.jsxs("div",{className:"flex items-center relative",children:[x.size>1&&t.jsx(he,{className:"mr-2",side:"left",environment:r,showAddEnvironment:!1,onSelect:()=>{C(!0),s(!1)},size:M.md,disabled:k||i!==z.None||a===P.Applying||a===P.Cancelling}),t.jsx(Ie,{className:"w-full",size:M.md,onAdd:()=>{C(!0),s(!1)}})]})]})}):v()},children:[we&&t.jsx(ye,{className:"w-3 h-3 mr-1"}),t.jsx("span",{className:"inline-block",children:dt(a,i)})]}),L&&t.jsx(he,{className:"rounded-none rounded-r-lg border-l mx-0",environment:r,disabled:ee})]}),t.jsx(ut,{environment:r,plan:w,isLoading:k,hasChanges:m})]})}function ut({isLoading:e,hasChanges:a,environment:i,plan:n}){var o,u,c,s;return t.jsx("span",{className:"flex align-center h-full w-full",children:t.jsx(t.Fragment,{children:e?t.jsxs("span",{className:"flex items-center ml-2",children:[t.jsx(ye,{className:"w-3 h-3 mr-1"}),t.jsx("span",{className:"inline-block text-xs text-neutral-500",children:"Checking..."})]}):t.jsxs(t.Fragment,{children:[i.isInitial&&i.isLocal&&t.jsx("span",{title:"New",className:"block ml-1 px-2 first-child:ml-0 rounded-full bg-success-10 text-success-500 text-xs text-center font-bold",children:"New"}),[a,e,i.isLocal].every(D)&&t.jsx("span",{title:"Latest",className:"block ml-1 px-2 first-child:ml-0 rounded-full bg-neutral-10 text-xs text-center",children:t.jsx("span",{children:"Latest"})}),T((o=n==null?void 0:n.changes)==null?void 0:o.added)&&t.jsx(_,{headline:"Added Models",type:A.Add,changes:n.changes.added}),T((u=n==null?void 0:n.changes)==null?void 0:u.modified.direct)&&t.jsx(_,{headline:"Direct Changes",type:A.Direct,changes:n.changes.modified.direct.map(({model_name:r})=>r)}),T((c=n==null?void 0:n.changes)==null?void 0:c.modified.indirect)&&t.jsx(_,{headline:"Indirectly Modified",type:A.Indirect,changes:n.changes.modified.indirect.map(r=>r.model_name)}),T((s=n==null?void 0:n.changes)==null?void 0:s.removed)&&t.jsx(_,{headline:"Removed Models",type:A.Remove,changes:n.changes.removed})]})})})}function he({onSelect:e,environment:a,disabled:i,side:n=H.Right,className:o,showAddEnvironment:u=!0,size:c=M.sm}){const s=S(d=>d.environments),r=S(d=>d.setEnvironment),x=S(d=>d.removeLocalEnvironment),g=Te(O.Button);return t.jsx(O,{children:({close:d})=>t.jsxs(t.Fragment,{children:[t.jsxs(g,{variant:W.Alternative,size:c,disabled:i,className:j(o),children:[t.jsx("span",{className:j("block overflow-hidden truncate",(a.isLocal||i)&&"text-neutral-500",a.isSynchronized&&"text-primary-500"),children:a.name}),t.jsx("span",{className:"pointer-events-none inset-y-0 right-0 flex items-center pl-2",children:t.jsx(Le,{className:"h-4 w-4","aria-hidden":"true"})})]}),t.jsx(be,{as:f.Fragment,leave:"transition ease-in duration-100",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:t.jsxs("div",{className:j("absolute top-9 overflow-hidden shadow-xl bg-theme border-2 border-primary-20 rounded-md flex flex-col z-10",n===H.Left&&"left-0",n===H.Right&&"right-0"),children:[t.jsxs(O.Items,{className:"overflow-auto max-h-80 py-2 hover:scrollbar scrollbar--vertical",children:[Array.from(s).map(m=>t.jsx(O.Item,{children:({active:I})=>t.jsxs("div",{onClick:w=>{w.stopPropagation(),r(m),e==null||e()},className:j("flex justify-between items-center px-4 py-1 cursor-pointer overflow-auto",I&&"bg-primary-10",m===a&&"pointer-events-none cursor-default bg-secondary-10"),children:[t.jsxs("div",{className:"flex items-start",children:[t.jsx(Ve,{className:j("w-4 h-4 text-primary-500 mt-1",I&&"opacity-10",m!==a&&"opacity-0")}),t.jsxs("span",{className:"block",children:[t.jsxs("span",{className:"flex items-center",children:[t.jsx("span",{className:j("block truncate ml-2",m.isSynchronized&&"text-primary-500"),children:m.name}),t.jsxs("small",{className:"block ml-2",children:["(",m.type,")"]})]}),m.isDefault&&t.jsx("span",{className:"flex ml-2",children:t.jsx("small",{className:"text-xs text-neutral-500",children:"Default Environment"})})]})]}),m.isLocal&&m!==a&&t.jsx(X,{className:"my-0 mx-0",size:M.xs,variant:W.Neutral,onClick:w=>{w.stopPropagation(),x(m)},children:"-"})]})},m.name)),u&&t.jsxs(t.Fragment,{children:[t.jsx(de,{}),t.jsx(Ie,{onAdd:d,className:"mt-2 px-2"})]})]}),t.jsx(de,{})]})})]})})}function Ie({onAdd:e,className:a,label:i="Add",size:n=M.sm}){const o=S(d=>d.getNextEnvironment),u=S(d=>d.isExistingEnvironment),c=S(d=>d.addLocalEnvironment),[s,r]=f.useState(""),[x,g]=f.useState(o().name);return t.jsxs("div",{className:j("flex w-full items-center",a),children:[t.jsx(me,{className:"my-0 mx-0 mr-4 min-w-[10rem] w-full",size:n,children:({className:d})=>t.jsx(me.Textfield,{className:j(d,"w-full"),placeholder:"Environment",value:s,onInput:m=>{m.stopPropagation(),r(m.target.value)}})}),t.jsx(X,{className:"my-0 mx-0 font-bold",size:n,disabled:$e(s)||u(s),onClick:d=>{d.stopPropagation(),c(s,x),r(""),g(o().name),e==null||e()},children:i})]})}function _({headline:e,type:a,changes:i}){const[n,o]=f.useState(!1);return t.jsx(pe,{onMouseEnter:()=>{o(!0)},onMouseLeave:()=>{o(!1)},className:"relative flex",children:()=>t.jsxs(t.Fragment,{children:[t.jsx("span",{className:j("inline-block ml-1 px-2 rounded-full text-xs font-bold text-neutral-100 cursor-default border border-inherit",a===A.Add&&"bg-success-500 border-success-500",a===A.Remove&&"bg-danger-500 border-danger-500",a===A.Direct&&"bg-secondary-500 border-secondary-500",a===A.Indirect&&"bg-warning-500 border-warning-500",a==="metadata"&&"bg-neutral-500 border-neutral-500"),children:i.length}),t.jsx(be,{show:n,as:f.Fragment,enter:"transition ease-out duration-200",enterFrom:"opacity-0 translate-y-1",enterTo:"opacity-100 translate-y-0",leave:"transition ease-in duration-150",leaveFrom:"opacity-100 translate-y-0",leaveTo:"opacity-0 translate-y-1",children:t.jsx(pe.Panel,{className:"absolute right-1 z-10 mt-8 transform flex p-2 bg-theme-lighter shadow-xl focus:ring-2 ring-opacity-5 rounded-lg ",children:t.jsx(fe,{headline:e,type:a,className:"w-full h-full max-w-[50vw] max-h-[40vh] overflow-hidden overflow-y-auto ",children:t.jsx(fe.Default,{type:a,changes:i})})})})]})})}function dt(e,a){return e===P.Running?"Running Plan...":e===P.Applying?"Applying Plan...":e===P.Cancelling?"Cancelling Plan...":a===z.None?"Run Plan":"Setting Plan..."}export{wt as default};
