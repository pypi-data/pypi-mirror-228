Metadata-Version: 2.1
Name: duetector
Version: 0.0.2rc0
Summary: duetector
Project-URL: Source, https://github.com/hitsz-ids/duetector
Author: hitsz-ids
License: Apache Software License 2.0
License-File: LICENSE
Keywords: duetector
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.8
Classifier: Programming Language :: Python :: 3.9
Classifier: Programming Language :: Python :: 3.10
Classifier: Programming Language :: Python :: 3.11
Requires-Python: >=3.8
Requires-Dist: click
Requires-Dist: loguru
Requires-Dist: pluggy
Requires-Dist: psutil
Requires-Dist: pydantic
Requires-Dist: sqlalchemy>=2
Requires-Dist: tomli
Requires-Dist: tomli-w
Provides-Extra: test
Requires-Dist: pytest; extra == 'test'
Requires-Dist: pytest-cov; extra == 'test'
Requires-Dist: pytype; extra == 'test'
Description-Content-Type: text/markdown

<h2 align="center">duetectorğŸ”: åŸºäºeBPFçš„æ•°æ®ä½¿ç”¨æ¢æµ‹å™¨</h2>
<p align="center">
<a href="https://github.com/hitsz-ids/duetector/actions"><img alt="Actions Status" src="https://github.com/hitsz-ids/duetector/actions/workflows/python-package.yml/badge.svg"></a>
<a href="https://results.pre-commit.ci/latest/github/hitsz-ids/duetector/main"><img alt="pre-commit.ci status" src="https://results.pre-commit.ci/badge/github/hitsz-ids/duetector/main.svg"></a>
<a href="https://github.com/hitsz-ids/duetector/blob/main/LICENSE"><img alt="LICENSE" src="https://img.shields.io/github/license/hitsz-ids/duetector"></a>
<a href="https://github.com/hitsz-ids/duetector/releases/"><img alt="Releases" src="https://img.shields.io/github/v/release/hitsz-ids/duetector"></a>
<a href="https://github.com/hitsz-ids/duetector/releases/"><img alt="Pre Releases" src="https://img.shields.io/github/v/release/hitsz-ids/duetector?include_prereleases&label=pre-release&logo=github"></a>
<a href="https://github.com/hitsz-ids/duetector"><img alt="Last Commit" src="https://img.shields.io/github/last-commit/hitsz-ids/duetector"></a>
<a href="https://github.com/hitsz-ids/duetector"><img alt="Python version" src="https://img.shields.io/pypi/pyversions/duetector"></a>
</p>

<p align="center">
<a href="./README.md">ä¸­æ–‡</a> | <a href="./README_en.md">English</a>
</p>

## ç®€ä»‹

> duetectoræ˜¯DataUCONé¡¹ç›®ä¸­çš„ç»„ä»¶ä¹‹ä¸€ï¼ŒDataUCONé¡¹ç›®æ—¨åœ¨ä¸ºæ•°æ®ä½¿ç”¨æ§åˆ¶æä¾›æ”¯æŒã€‚
>
> [æŸ¥çœ‹DataUCONçš„ç½‘é¡µ](https://dataucon.idslab.io/)
>
> [æ·±å…¥äº†è§£å¹¶éƒ¨ç½²DataUCON](https://github.com/hitsz-ids/dataucon)

duetectorğŸ”æ˜¯ä¸€ä¸ªåŸºäºeBPFçš„æ•°æ®ä½¿ç”¨æ¢æµ‹å™¨ï¼Œå®ƒå¯ä»¥åœ¨Linuxå†…æ ¸ä¸­å¯¹æ•°æ®ä½¿ç”¨è¡Œä¸ºè¿›è¡Œæ¢æµ‹ï¼Œä»è€Œä¸ºæ•°æ®ä½¿ç”¨æ§åˆ¶æä¾›æ”¯æŒã€‚

**ğŸ›ğŸğŸ§ª é¡¹ç›®æ­£åœ¨å¤§åŠ›å¼€å‘ä¸­ï¼ŒæœŸå¾…ä»»ä½•BugæŠ¥å‘Šã€åŠŸèƒ½è¯·æ±‚ã€åˆå¹¶è¯·æ±‚**

åœ¨[ABAUCæ§åˆ¶æ¨¡å‹](https://github.com/hitsz-ids/dataucon)å½“ä¸­ï¼Œduetectorå¯ä½œä¸ºPIPï¼ˆPolicy Information Pointï¼‰æ¥è·å–æ•°æ®ä½¿ç”¨è¡Œä¸ºï¼Œä»è€Œä¸ºPDPï¼ˆPolicy Decision Pointï¼‰æä¾›æ•°æ®ä½¿ç”¨è¡Œä¸ºçš„ä¿¡æ¯ã€‚

## ç›®å½•

- [ä¸»è¦ç‰¹æ€§](#ä¸»è¦ç‰¹æ€§)
- [å®‰è£…](#å®‰è£…)
- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [APIæ–‡æ¡£ä¸é…ç½®æ–‡æ¡£](#APIæ–‡æ¡£ä¸é…ç½®æ–‡æ¡£)
- [ç»´æŠ¤è€…](#ç»´æŠ¤è€…)
- [å¦‚ä½•è´¡çŒ®](#å¦‚ä½•è´¡çŒ®)
- [è®¸å¯è¯](#è®¸å¯è¯)

## ä¸»è¦ç‰¹æ€§

- [X] æ’ä»¶åŒ–ç³»ç»Ÿ
  - [X] æ”¯æŒè‡ªå®šä¹‰tracer
  - [X] æ”¯æŒè‡ªå®šä¹‰filter
  - [X] æ”¯æŒè‡ªå®šä¹‰collector
  - [X] [è‡ªå®šä¹‰æ’ä»¶ç¤ºä¾‹](./examples/)
- [ ] é…ç½®ç®¡ç†
  - [X] ä½¿ç”¨å•ä¸€é…ç½®æ–‡ä»¶é…ç½®
  - [X] æ”¯æŒç”Ÿæˆæ’ä»¶é…ç½®
  - [ ] æ”¯æŒåŠ¨æ€åŠ è½½é…ç½®
- [ ] åŸºäºeBPFçš„æ•°æ®ä½¿ç”¨æ¢æµ‹å™¨
  - [X] æ–‡ä»¶æ‰“å¼€æ“ä½œ
  - [ ] â€¦â€¦
- [X] æ”¯æŒSQLæ•°æ®åº“çš„æ•°æ®æ”¶é›†å™¨
- [X] CLIå·¥å…·
- [ ] PIPæœåŠ¡

eBPFæ¢æµ‹å™¨éœ€è¦å†…æ ¸æ”¯æŒï¼Œè¯¦è§[å†…æ ¸æ”¯æŒ](./docs/kernel_config.md)

## å®‰è£…

ä»£ç é€šè¿‡Pypiåˆ†å‘ï¼Œä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤å®‰è£…

```bash
pip install duetector
```

ç›®å‰ï¼Œä»£ç ä¾èµ–[BCC](https://github.com/iovisor/bcc)å¯¹eBPFä»£ç è¿›è¡Œå³æ—¶ç¼–è¯‘ï¼Œæ¨è[å®‰è£…æœ€æ–°çš„BCCç¼–è¯‘å™¨](https://github.com/iovisor/bcc/blob/master/INSTALL.md)

æˆ–ä½¿ç”¨æˆ‘ä»¬æä¾›çš„Dockeré•œåƒï¼Œå…¶ä½¿ç”¨[JupyterLab](https://github.com/jupyterlab/jupyterlab)ä½œä¸º**ç¤ºä¾‹**ç”¨æˆ·åº”ç”¨ï¼Œæ‚¨ä¹Ÿå¯ä»¥è‡ªè¡Œä¿®æ”¹[Dockerfile](./docker/Dockerfile)å’Œ[å¯åŠ¨è„šæœ¬](./docker/start.sh)æ¥è‡ªå®šä¹‰ç”¨æˆ·ç¨‹åº

```bash
docker pull dataucon/duetector:latest
```

é¢„å‘å¸ƒç‰ˆæœ¬å°†ä¸ä¼šæ›´æ–°åˆ° `latest`ä¸Šï¼Œæ‚¨å¯ä»¥æŒ‡å®štagè¿›è¡Œæ‹‰å–ï¼Œå¦‚ `v0.0.1a`

```bash
docker pull dataucon/duetector:v0.0.1a
```

ä½¿ç”¨dockeré•œåƒè¿è¡Œçš„æ›´å¤šç»†èŠ‚è¯·å‚è€ƒ[è¿™é‡Œ](./docs/how-to/run-with-docker.md)

## å¿«é€Ÿå¼€å§‹

ä½¿ç”¨å‘½ä»¤è¡Œå¯åŠ¨monitorï¼Œç”±äºbccéœ€è¦rootæƒé™ï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨ `sudo` å‘½ä»¤ï¼Œè¿™å°†å¯åŠ¨æ‰€æœ‰çš„æ¢æµ‹å™¨ï¼Œå¹¶å°†æ¢æµ‹å†…å®¹æ”¶é›†åˆ°å½“å‰ç›®å½•ä¸‹çš„ `duetector-dbcollector.sqlite3`æ–‡ä»¶ä¸­

```bash
sudo duectl start
```

æŒ‰ä¸‹ `CRTL+C`å¯ä»¥é€€å‡ºç›‘æµ‹ï¼Œä½ å°†çœ‹åˆ°å±å¹•ä¸Šè¾“å‡ºäº†ä¸€æ®µæ€»ç»“

```
{'DBCollector': {'OpenTracer': {'count': 31, 'first at': 249920233249912, 'last': Tracking(tracer='OpenTracer', pid=641616, uid=1000, gid=1000, comm='node', cwd=None, fname='SOME-FILE', timestamp=249923762308577, extended={})}}}
```

å¯åŠ¨ `DEBUG`æ—¥å¿—

```bash
sudo DUETECTOR_LOG_LEVEL=DEBUG duectl start
```

å¯åŠ¨æ—¶ï¼Œé…ç½®æ–‡ä»¶å°†è‡ªåŠ¨ç”Ÿæˆï¼Œå¯¹åº”è·¯å¾„ä¸º `~/.config/duetector` ï¼Œå¯ä»¥ä½¿ç”¨ `--config`æŒ‡å®šä½¿ç”¨çš„é…ç½®æ–‡ä»¶

```bash
sudo duectl start --config <config-file-path>
```

å½“ä½¿ç”¨æ’ä»¶æ—¶ï¼Œé»˜è®¤çš„é…ç½®æ–‡ä»¶ä¸ä¼šåŒ…å«æ’ä»¶çš„é…ç½®å†…å®¹ï¼Œä½¿ç”¨åŠ¨æ€ç”Ÿæˆé…ç½®çš„æŒ‡ä»¤ç”Ÿæˆå¸¦æœ‰æ’ä»¶é…ç½®çš„é…ç½®æ–‡ä»¶ï¼Œè¿™ä¸ªæŒ‡ä»¤ä¹Ÿæ”¯æŒåˆå¹¶å½“å‰å·²æœ‰çš„é…ç½®æ–‡ä»¶å’Œç¯å¢ƒå˜é‡

```bash
duectl generate-dynamic-config --help
```

å½“é…ç½®æ–‡ä»¶å‡ºé”™æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ `generate-config` æ¢å¤é»˜è®¤çŠ¶æ€

```bash
duectl generate-config
```

æ›´è¿›ä¸€æ­¥çš„ï¼Œåå°è¿è¡Œå¯ä»¥ä½¿ç”¨ `duectl-daemon start`å‘½ä»¤ï¼Œè¿™å°†ä¼šåœ¨åå°è¿è¡Œä¸€ä¸ªå®ˆæŠ¤è¿›ç¨‹ï¼Œä½ å¯ä»¥ä½¿ç”¨ `duectl-daemon stop`æ¥åœæ­¢å®ƒ

```bash
duectl-daemon --help
Usage: duectl-daemon [OPTIONS] COMMAND [ARGS]...

Options:
  --help  Show this message and exit.

Commands:
  start   Start a daemon of command `duectl start`, All arguments after...
  status  Status of daemon Determined by the existence of pid file in...
  stop    Stop daemon Determined by the existence of pid file in `workdir`
```

æ›´å¤šæ–‡æ¡£å’Œä¾‹å­å¯ä»¥åœ¨[è¿™é‡Œ](./docs/)æ‰¾åˆ°ã€‚

## APIæ–‡æ¡£ä¸é…ç½®æ–‡æ¡£

WIP è¿™ä¸€éƒ¨åˆ†å†…å®¹æ˜¯PIPç›¸å…³çš„ï¼Œç›®å‰è¿˜æ²¡æœ‰å®Œæˆï¼Œå®Œæˆåå°†åŒ…æ‹¬å¯é…ç½®çš„ç±»çš„å†…å®¹ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨duetectorä½œä¸ºPIPçš„å†…å®¹ã€‚

## ç»´æŠ¤è€…

æœ¬é¡¹ç›®ç”±**å“ˆå°”æ»¨å·¥ä¸šå¤§å­¦ï¼ˆæ·±åœ³ï¼‰æ•°æ®å®‰å…¨ç ”ç©¶é™¢**å‘èµ·ï¼Œè‹¥æ‚¨å¯¹æœ¬é¡¹ç›®ä»¥åŠDataUCONé¡¹ç›®æ„Ÿå…´è¶£å¹¶æ„¿æ„ä¸€èµ·å®Œå–„å®ƒï¼Œæ¬¢è¿åŠ å…¥æˆ‘ä»¬çš„å¼€æºç¤¾åŒºã€‚

## å¦‚ä½•è´¡çŒ®

éå¸¸æ¬¢è¿ä½ çš„åŠ å…¥ï¼[æä¸€ä¸ª Issue](https://github.com/hitsz-ids/duetector/issues/new) æˆ–è€…æäº¤ä¸€ä¸ª Pull Requestã€‚

å¼€å‘ç¯å¢ƒé…ç½®å’Œå…¶ä»–æ³¨æ„äº‹é¡¹è¯·å‚è€ƒ[å¼€å‘è€…æ–‡æ¡£](./CONTRIBUTING.md)ã€‚

åœ¨è¿™é‡Œäº†è§£æœ¬é¡¹ç›®çš„è®¾è®¡æ€è·¯å’Œæ¶æ„ï¼š[è®¾è®¡æ–‡æ¡£](./docs/design/README.md)

## è®¸å¯è¯

æœ¬é¡¹ç›®ä½¿ç”¨ Apache-2.0 licenseï¼Œæœ‰å…³åè®®è¯·å‚è€ƒ[LICENSE](https://github.com/hitsz-ids/duetector/blob/main/LICENSE)ã€‚
