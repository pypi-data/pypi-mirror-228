(self.webpackChunkjupyterlab_remote_contents=self.webpackChunkjupyterlab_remote_contents||[]).push([[809],{809:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>w});var n=r(303),s=r(122),o=r(720),i=r(745),a=r(344),c=r(155);let l;var u,h;l="undefined"==typeof window?r(26):WebSocket,function(e){e.makeSettings=function(e){return h.makeSettings(e)},e.makeRequest=function(e,t,r,n){const s={...r.queryParams,...n},o=e+a.URLExt.objectToQueryString(s);return h.handleRequest(o,t,r)};class t extends Error{constructor(e,r=t._defaultMessage(e),n=""){super(r),this.response=e,this.traceback=n}static async create(e){try{const r=await e.json(),{message:n,traceback:s}=r;return s&&console.error(s),new t(e,n??t._defaultMessage(e),s??"")}catch(r){return console.debug(r),new t(e)}}static _defaultMessage(e){return`Invalid response: ${e.status} ${e.statusText}`}}e.ResponseError=t;class r extends TypeError{constructor(e){super(e.message),this.stack=e.stack}}e.NetworkError=r}(u||(u={})),function(e){e.makeSettings=function(e={}){const t=a.PageConfig.getBaseUrl(),r=a.PageConfig.getWsUrl(),n=e.baseUrl||"",s=e.queryParams||{};let o=e.wsUrl;return o||n!==t||(o=r),o||0!==n.indexOf("http")||(o="ws"+n.slice(4)),o=o??r,{init:{cache:"no-store",credentials:"same-origin"},fetch,Headers,Request,WebSocket:l,token:a.PageConfig.getToken(),appUrl:a.PageConfig.getOption("appUrl"),appendToken:"undefined"==typeof window||void 0!==c&&void 0!==c?.env?.JEST_WORKER_ID||a.URLExt.getHostName(t)!==a.URLExt.getHostName(o),...e,baseUrl:n,queryParams:s,wsUrl:o}},e.handleRequest=function(e,t,r){if(0!==e.indexOf(r.baseUrl))throw new Error("Can only be used for notebook server requests");"no-store"===(t.cache??r.init.cache)&&(e+=(/\?/.test(e)?"&":"?")+(new Date).getTime());const n=new r.Request(e,{...r.init,...t});let s=!1;if(r.token&&(s=!0,n.headers.append("Authorization",`token ${r.token}`)),"undefined"!=typeof document&&document?.cookie){const e=("_xsrf",document.cookie.match("\\b_xsrf=([^;]*)\\b")?.[1]);void 0!==e&&(s=!0,n.headers.append("X-XSRFToken",e))}return!n.headers.has("Content-Type")&&s&&n.headers.set("Content-Type","application/json"),r.fetch.call(null,n).catch((e=>{throw new u.NetworkError(e)}))}}(h||(h={}));var d,f=r(840);class p{constructor(e={}){this._isDisposed=!1,this._fileChanged=new f.Signal(this),this.name=e.name??"Default",this._apiEndpoint=e.apiEndpoint??"api/contents",this.serverSettings=e.serverSettings??u.makeSettings()}get fileChanged(){return this._fileChanged}get isDisposed(){return this._isDisposed}dispose(){this.isDisposed||(this._isDisposed=!0,f.Signal.clearData(this))}async get(e,t){let r=this._getUrl(e),n={};if(t){"notebook"===t.type&&delete t.format;const e=t.content?"1":"0";n={...t,content:e}}const s=this.serverSettings,o=await u.makeRequest(r,{},s,n);if(200!==o.status)throw await u.ResponseError.create(o);const i=await o.json();return d.validateContentsModel(i),i}getDownloadUrl(e){const t=this.serverSettings.baseUrl;let r=a.URLExt.join(t,"files",a.URLExt.encodeParts(e));const n=document.cookie.match("\\b_xsrf=([^;]*)\\b");if(n){const e=new URL(r);e.searchParams.append("_xsrf",n[1]),r=e.toString()}return Promise.resolve(r)}async newUntitled(e={}){let t="{}";e&&(e.ext&&(e.ext=d.normalizeExtension(e.ext)),t=JSON.stringify(e));const r=this.serverSettings,n=this._getUrl(e.path??""),s={method:"POST",body:t},o=await u.makeRequest(n,s,r);if(201!==o.status)throw await u.ResponseError.create(o);const i=await o.json();return d.validateContentsModel(i),this._fileChanged.emit({type:"new",oldValue:null,newValue:i}),i}async delete(e){const t=this._getUrl(e),r=this.serverSettings,n=await u.makeRequest(t,{method:"DELETE"},r);if(204!==n.status)throw await u.ResponseError.create(n);this._fileChanged.emit({type:"delete",oldValue:{path:e},newValue:null})}async rename(e,t){const r=this.serverSettings,n=this._getUrl(e),s={method:"PATCH",body:JSON.stringify({path:t})},o=await u.makeRequest(n,s,r);if(200!==o.status)throw await u.ResponseError.create(o);const i=await o.json();return d.validateContentsModel(i),this._fileChanged.emit({type:"rename",oldValue:{path:e},newValue:i}),i}async save(e,t={}){const r=this.serverSettings,n=this._getUrl(e),s={method:"PUT",body:JSON.stringify(t)},o=await u.makeRequest(n,s,r);if(200!==o.status&&201!==o.status)throw await u.ResponseError.create(o);const i=await o.json();return d.validateContentsModel(i),this._fileChanged.emit({type:"save",oldValue:null,newValue:i}),i}async copy(e,t){const r=this.serverSettings,n=this._getUrl(t),s={method:"POST",body:JSON.stringify({copy_from:e})},o=await u.makeRequest(n,s,r);if(201!==o.status)throw await u.ResponseError.create(o);const i=await o.json();return d.validateContentsModel(i),this._fileChanged.emit({type:"new",oldValue:null,newValue:i}),i}async createCheckpoint(e){const t=this._getUrl(e,"checkpoints"),r=await u.makeRequest(t,{method:"POST"},this.serverSettings);if(201!==r.status)throw await u.ResponseError.create(r);const n=await r.json();return d.validateCheckpointModel(n),n}async listCheckpoints(e){const t=this._getUrl(e,"checkpoints"),r=await u.makeRequest(t,{},this.serverSettings);if(200!==r.status)throw await u.ResponseError.create(r);const n=await r.json();if(!Array.isArray(n))throw new Error("Invalid Checkpoint list");for(let e=0;e<n.length;e++)d.validateCheckpointModel(n[e]);return n}async restoreCheckpoint(e,t){const r=this._getUrl(e,"checkpoints",t),n=await u.makeRequest(r,{method:"POST"},this.serverSettings);if(204!==n.status)throw await u.ResponseError.create(n)}async deleteCheckpoint(e,t){const r=this._getUrl(e,"checkpoints",t),n=await u.makeRequest(r,{method:"DELETE"},this.serverSettings);if(204!==n.status)throw await u.ResponseError.create(n)}_getUrl(...e){const t=e.map((e=>a.URLExt.encodeParts(e))),r=this.serverSettings.baseUrl;if(!r)throw new Error("Jupyter server URL not set");return a.URLExt.join(r,this._apiEndpoint,...t)}}!function(e){function t(e,t,r,n=[]){if(!e.hasOwnProperty(t))throw Error(`Missing property '${t}'`);const s=e[t];if(void 0!==r){let e=!0;switch(r){case"array":e=Array.isArray(s);break;case"object":e=void 0!==s;break;default:e=typeof s===r}if(!e)throw new Error(`Property '${t}' is not of type '${r}'`);if(n.length>0){let e=!0;switch(r){case"string":case"number":case"boolean":e=n.includes(s);break;default:e=n.findIndex((e=>e===s))>=0}if(!e)throw new Error(`Property '${t}' is not one of the valid values ${JSON.stringify(n)}`)}}}e.normalizeExtension=function(e){return e.length>0&&0!==e.indexOf(".")&&(e=`.${e}`),e},e.validateProperty=t,e.validateContentsModel=function(e){t(e,"name","string"),t(e,"path","string"),t(e,"type","string"),t(e,"created","string"),t(e,"last_modified","string"),t(e,"mimetype","object"),t(e,"content","object"),t(e,"format","object")},e.validateCheckpointModel=function(e){t(e,"id","string"),t(e,"last_modified","string")}}(d||(d={}));const w={id:"jupyterlab-remote-contents:plugin",requires:[s.IFileBrowserFactory,o.ITranslator],autoStart:!0,activate:(e,t,r)=>{const{serviceManager:o}=e,{createFileBrowser:a}=t,c=r.load("jupyterlab-remote-contents"),l=u.makeSettings(),h=new p({serverSettings:l,name:"Remote"});o.contents.addDrive(h);const d=a("jp-remote-contents-browser",{driveName:h.name,restore:!1});d.title.caption=c.__("Remote Contents (not connected)"),d.title.icon=i.listIcon;const f=new n.ToolbarButton({icon:i.folderIcon,onClick:async()=>{let e=prompt("Please enter the Jupyter server URL:","http://127.0.0.1:8000");if(e){const t=new URL(e),r=t.search,n=Object.fromEntries(t.searchParams);r&&(e=e.slice(0,-r.length)),h.serverSettings.baseUrl=e,h.serverSettings.queryParams=n,d.title.caption=c.__(`Remote Contents at ${e}`),d.model.cd("/")}},tooltip:c.__("Connect to Jupyter Server")}),w=new n.ToolbarButton({icon:i.newFolderIcon,onClick:async()=>{d.createNewDirectory()},tooltip:c.__("New Folder")}),m=new s.Uploader({model:d.model,translator:r}),g=new n.ToolbarButton({icon:i.refreshIcon,onClick:async()=>{d.model.refresh()},tooltip:c.__("Refresh File Browser")});d.toolbar.insertItem(0,"connect-to-server",f),d.toolbar.insertItem(1,"create-new-directory",w),d.toolbar.insertItem(2,"upload",m),d.toolbar.insertItem(3,"refresh",g),e.shell.add(d,"left")}}},155:e=>{var t,r,n=e.exports={};function s(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function i(e){if(t===setTimeout)return setTimeout(e,0);if((t===s||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(r){try{return t.call(null,e,0)}catch(r){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:s}catch(e){t=s}try{r="function"==typeof clearTimeout?clearTimeout:o}catch(e){r=o}}();var a,c=[],l=!1,u=-1;function h(){l&&a&&(l=!1,a.length?c=a.concat(c):u=-1,c.length&&d())}function d(){if(!l){var e=i(h);l=!0;for(var t=c.length;t;){for(a=c,c=[];++u<t;)a&&a[u].run();u=-1,t=c.length}a=null,l=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===o||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function p(){}n.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];c.push(new f(e,t)),1!==c.length||l||i(d)},f.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=p,n.addListener=p,n.once=p,n.off=p,n.removeListener=p,n.removeAllListeners=p,n.emit=p,n.prependListener=p,n.prependOnceListener=p,n.listeners=function(e){return[]},n.binding=function(e){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(e){throw new Error("process.chdir is not supported")},n.umask=function(){return 0}},26:e=>{"use strict";e.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}}}]);